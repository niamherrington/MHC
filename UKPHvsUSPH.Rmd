---
title: "MHQ Sep 24 Non US cohort overview"
author: "Niamh Errington"
date: "`r format(Sys.time(), '%d %B %Y')`" 
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
    toc_collapsed: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE}
#load libraries & read in data
library(tidyverse)
library(readr)
library(readxl)
library(data.table)
library(kableExtra)
library(lubridate)
library(janitor)
library(RColorBrewer)
library(likert)
library(labelled)
library(ggstats)
library(tidyverse)
library(pheatmap)
library(polycor)
library(ggtext)
library(dunn.test)

source("OrderFactorsSep24_notUS.R")
source("OrderFactorsSep24.R")
source("UsefulFunctionUS.R")

Other_1st <- Other_1st %>% left_join(., QuestionKey, by = c("Question" = "Identifier")) %>% mutate(Cohort = "UK")

# Fill in missing values in Sheet based on the value in identifier
Other_1st <- Other_1st %>%
  mutate(Sheet = case_when(is.na(Sheet) & Question %in% c('cannabisSmoking', 'cannabisVaping', 'currentSmoking', 'currentVaping', 'everQuitSmoking', 'pastSmokeless', 'pastVaping', 'tobaccoProducts', 'tobaccoProductsEver', 'everQuitSmokeless', 'everQuitVaping', 'lastCannabisSmoking', 'pastCannabisSmoking', 'lastCannabisVaping', 'pastCannabisVaping') ~ "Vaping_Smoking",   
    is.na(Sheet) & Question %in% c('NonIdentifiableDemographics.patientHeightInches', 'regionInformation.countryCode', 'NonIdentifiableDemographics.patientBloodType' ) ~ "DEMOGRAPHICS",   
     is.na(Sheet) & Question %in% c( 'heartAgeDataBloodGlucose_unit', 'heartAgeDataDiastolicBloodPressure', 'heartAgeDataDiastolicBloodPressure_unit', 'heartAgeDataHdl_unit', 'heartAgeDataSystolicBloodPressure_unit', 'heartAgeDataTotalCholesterol_unit') ~ "APH HEART AGE SURVEY",   
    TRUE ~ Sheet                           # Keep original value if no conditions match
  )) %>% filter(Comparison1 == "PH")

US_1st <- US_1st %>% left_join(., QuestionKey, by = c("Question" = "Identifier")) %>% filter(group == "pah") %>% mutate(Cohort = "USA")

# Fill in missing values in Sheet based on the value in identifier
US_1st <- US_1st %>%
  mutate(Sheet = case_when(is.na(Sheet) & Question %in% c('cannabisSmoking', 'cannabisVaping', 'currentSmoking', 'currentVaping', 'everQuitSmoking', 'pastSmokeless', 'pastVaping', 'tobaccoProducts', 'tobaccoProductsEver', 'everQuitSmokeless', 'everQuitVaping', 'lastCannabisSmoking', 'pastCannabisSmoking', 'lastCannabisVaping', 'pastCannabisVaping') ~ "Vaping_Smoking",   
    is.na(Sheet) & Question %in% c('NonIdentifiableDemographics.patientHeightInches', 'regionInformation.countryCode', 'NonIdentifiableDemographics.patientBloodType' ) ~ "DEMOGRAPHICS",   
     is.na(Sheet) & Question %in% c( 'heartAgeDataBloodGlucose_unit', 'heartAgeDataDiastolicBloodPressure', 'heartAgeDataDiastolicBloodPressure_unit', 'heartAgeDataHdl_unit', 'heartAgeDataSystolicBloodPressure_unit', 'heartAgeDataTotalCholesterol_unit') ~ "APH HEART AGE SURVEY",   
    TRUE ~ Sheet                           # Keep original value if no conditions match
  ))

Other_1stWide <- Other_1stWide %>% filter(Comparison1 == "PH") %>% mutate(Cohort = "UK")

US_1stWide <- US_1stWide %>% filter(group == "pah") %>% mutate(Cohort = "USA")

Other_1st_num <- Other_1st_num %>% filter(Comparison1 == "PH") %>% mutate(Cohort = "UK")
US_1st_num <- US_1st_num %>% filter(group == "pah") %>% mutate(Cohort = "USA")

#numeric
Num_cols <- intersect(colnames(Other_1st_num), colnames(US_1st_num))
Numeric_vars <- bind_rows(select(Other_1st_num, all_of(Num_cols)), select(US_1st_num, all_of(Num_cols)))

```


# Illness Mindset

```{r}
selectedillness_US <- US_1stWide %>% dplyr::select(healthCode, all_of(variable_list_illnessmindset$Identifier), Cohort) 
selectedillness_UK <- Other_1stWide %>% dplyr::select(healthCode, all_of(variable_list_illnessmindset$Identifier), Cohort) 
selectedillness <- rbind(selectedillness_UK, selectedillness_US) %>% as.data.frame()

kable(FreqWPerc(selectedillness, body_self_healing_in_many_different_circumstances, Cohort), caption = "Your body can heal itself on its own in many different circumstances.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_impact, Cohort), caption = "Chronic illness negatively impacts nearly all parts of life.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_body_meaning, Cohort), caption = "Having a chronic illness means that your body isnâ€™t doing its job.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_body_coping, Cohort), caption = "Your body is able to cope with a chronic illness.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_positive_opportunity, Cohort), caption = "A chronic illness can be an opportunity to make positive life changes.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_management, Cohort), caption = "A chronic illness is manageable.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_body_betrayal, Cohort), caption = "If you have a chronic illness, it means your body has betrayed you.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_more_meaning_in_life, Cohort), caption = "Having a chronic illness allows you to find more meaning in life.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_handling, Cohort), caption = "A chronic illness is something that can be dealt with.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, body_remarkable_self_healing, Cohort), caption = "In general, your body has remarkable self-healing properties.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_spoil, Cohort), caption = "Having a chronic illness spoils many parts of life.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_challenge, Cohort), caption = "Having a chronic illness is a challenge that can make you stronger.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_body_handling, Cohort), caption = "In general, your body is able to handle a chronic illness.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_runing_life, Cohort), caption = "A chronic illness ruins most aspects of life.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_body_management, Cohort), caption = "Your body is designed to deal with and manage chronic illnesses.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_relatively_normal_life, Cohort), caption = "You can live a relatively normal life with a chronic illness.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_body_failure, Cohort), caption = "Having a chronic illness means that your body has failed.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_empowering, Cohort), caption = "Fighting a chronic illness can be empowering.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, body_self_healing_from_most_conditions_and_diseases, Cohort), caption = "Your body is able to heal itself from most conditions and diseases.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(selectedillness, chronic_illness_body_blame, Cohort), caption = "Your body is to blame if you have a chronic illness.") %>% kable_styling(full_width = TRUE)

```

```{r}
colnames(selectedillness) <- c("healthCode", variable_list_illnessmindset$Prompt, "Cohort")

selectedillness%>% gglikert(., `Your body can heal itself on its own in many different circumstances.`:`Your body is to blame if you have a chronic illness.`, facet_cols = vars(Cohort), add_labels = FALSE) + geom_vline(xintercept = 0)
```


## Wilcox test 


```{r}
# Perform Mann-Whitney U Test (Wilcoxon Rank-Sum Test) for each variable
W_pvals_IllnessMindset <- lapply(variable_list_illnessmindset$Identifier, function(var) {
  formula <- as.formula(paste(var, "~ Cohort"))
  W_result <- wilcox.test(formula, data = Numeric_vars) 
  p_value <- W_result$p.value
  return(p_value)
})

# Create a table of p-values
W_pvals_IllnessMindset <- data.frame(variable = variable_list_illnessmindset$Identifier, Prompt = variable_list_illnessmindset$Prompt, p_value = unlist(W_pvals_IllnessMindset)) %>% dplyr::arrange(p_value) %>% mutate(p_adj = p.adjust(p_value, method = "BH")) 

kable(W_pvals_IllnessMindset, caption = "Wilcox test p values for Illness Mindset questions") %>% kable_styling(full_width = TRUE)
```

# Exercise process mindset

## First response, comparison 1

```{r}
expro_US <- US_1stWide %>% dplyr::select(healthCode, all_of(variable_list_exproc$Identifier), Cohort) 
expro_UK <- Other_1stWide %>% dplyr::select(healthCode, all_of(variable_list_exproc$Identifier), Cohort) 
expro <- rbind(expro_US, expro_UK) %>% as.data.frame()

kable(FreqWPerc(expro, easy, Cohort), caption = "Exercising is: easy") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(expro, pleasurable, Cohort), caption = "Exercising is: pleasurable") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(expro, relaxing, Cohort), caption = "Exercising is: relaxing") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(expro, convenient, Cohort), caption = "Exercising is: convenient") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(expro, fun, Cohort), caption = "Exercising is: fun") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(expro, social, Cohort), caption = "Exercising is: social") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(expro, indulgent, Cohort), caption = "Exercising is: indulgent") %>% kable_styling(full_width = TRUE)

```

## Wilcox Test

```{r}
# Perform test for each variable
W_pvals_Expro <- lapply(variable_list_exproc$Identifier, function(var) {
  formula <- as.formula(paste(var, "~ Cohort"))
  W_result <- wilcox.test(formula, data = Numeric_vars) 
  p_value <- W_result$p.value
  return(p_value)
})

# Create a table of p-values
W_pvals_Expro <- data.frame(variable = variable_list_exproc$Identifier, Prompt = variable_list_exproc$Prompt, p_value = unlist(W_pvals_Expro)) %>% dplyr::arrange(p_value) %>% mutate(p_adj = p.adjust(p_value, method = "BH")) 

kable(W_pvals_Expro, caption = "Wilcox test p values for Exercise process mindset questions. Simulated pvals = T") %>% kable_styling(full_width = TRUE)
```

## Figures


```{r}
exercise_all <- expro %>% dplyr::select(healthCode, variable_list_exproc$Identifier, Cohort) %>% mutate(easy = dplyr::recode(easy, "Very difficult" = "Strongly disagree", "Somewhat difficult" = "Disagree", "Somewhat easy" = "Agree", "Very easy" = "Strongly agree"),                                                                                                   pleasurable = dplyr::recode(pleasurable, "Very unpleasant" = "Strongly disagree", "Somewhat unpleasant" = "Disagree", "Somewhat pleasurable" = "Agree", "Very pleasurable" = "Strongly agree"),                                                                                               relaxing = dplyr::recode(relaxing, "Very stressful" = "Strongly disagree", "Somewhat stressful" = "Disagree", "Somewhat relaxing" = "Agree", "Very relaxing" = "Strongly agree"),
                   convenient = dplyr::recode(convenient, "Very inconvenient" = "Strongly disagree", "Somewhat inconvenient" = "Disagree", "Somewhat convenient" = "Agree", "Very convenient" = "Strongly agree"),
                  fun = dplyr::recode(fun, "Very boring" = "Strongly disagree", "Somewhat boring" = "Disagree", "Somewhat fun" = "Agree", "Very fun" = "Strongly agree"),
                  social = dplyr::recode(social, "Very lonely" = "Strongly disagree", "Somewhat lonely" = "Disagree", "Somewhat social" = "Agree", "Very social" = "Strongly agree"),
                  indulgent = dplyr::recode(indulgent, "Very depriving" = "Strongly disagree", "Somewhat depriving" = "Disagree", "Somewhat indulgent" = "Agree", "Very indulgent" = "Strongly agree") ) %>% filter(!is.na(Cohort))

exercise_all%>% gglikert(., `easy`:`indulgent`, facet_cols = vars(Cohort), add_labels = FALSE) + geom_vline(xintercept = 0)

exercise_all <- exercise_all %>%  
  dplyr::rename("Exercising is easy" = easy) %>%
  dplyr::rename("Exercising is relaxing" = relaxing) %>%
  dplyr::rename("Exercising is social" = social) %>%
  dplyr::rename("Exercising is indulgent" = indulgent) %>%
  dplyr::rename("Exercising is pleasurable" = pleasurable) %>%
  dplyr::rename("Exercising is convenient" = convenient) %>%
  dplyr::rename("Exercising is fun" = fun)

exercise_all%>% gglikert(., `Exercising is easy`:`Exercising is indulgent`, facet_cols = vars(Cohort), add_labels = FALSE) + geom_vline(xintercept = 0)

```

# Adequacy of activity mindset 

## First response, comparison 1

```{r}
act_US <- US_1stWide %>% dplyr::select(healthCode, all_of(variable_list_activity$Identifier), Cohort) 
act_UK <- Other_1stWide %>% dplyr::select(healthCode, all_of(variable_list_activity$Identifier), Cohort) 
act_mind <- bind_rows(act_US, act_UK) %>% as.data.frame()

kable(FreqWPerc(act_mind, unhealthy, Cohort), caption = "My current level of physical activity is unhealthy.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(act_mind, weight, Cohort), caption = "My current level of physical activity is helping me achieve or maintain a healthy body weight.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(act_mind, beneficial, Cohort), caption = "How harmful/beneficial is your current level of physical activity for your health?") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(act_mind, disease, Cohort), caption = "How much does your current level of physical (in-)activity increase or decrease your risk of disease?") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(act_mind, muscles, Cohort), caption = "How much is your current level of physical (in-)activity strengthening or weakening your muscles?") %>% kable_styling(full_width = TRUE)
```

## Wilcox Test

```{r}
# Perform test for each variable
W_pvals_Actm <- lapply(variable_list_activity$Identifier, function(var) {
  formula <- as.formula(paste(var, "~ Cohort"))
  W_result <- wilcox.test(formula, data = Numeric_vars) 
  p_value <- W_result$p.value
  return(p_value)
})

# Create a table of p-values
W_pvals_Actm <- data.frame(variable = variable_list_activity$Identifier, Prompt = variable_list_activity$Prompt, p_value = unlist(W_pvals_Actm)) %>% dplyr::arrange(p_value) %>% mutate(p_adj = p.adjust(p_value, method = "BH")) 

kable(W_pvals_Actm, caption = "Wilcox test p values for Activity mindset questions. Simulated pvals = T") %>% kable_styling(full_width = TRUE)
```

## Figures

```{r}
#1100 x 160 svg
bind_rows(select(US_1stWide, Cohort, unhealthy), select(Other_1stWide, Cohort, unhealthy))  %>% dplyr::rename("My current level of physical activity is unhealthy." = unhealthy) %>% gglikert(., `My current level of physical activity is unhealthy.`, facet_cols = vars(Cohort), add_labels = FALSE) 

bind_rows(select(US_1stWide, Cohort, disease), select(Other_1stWide, Cohort, disease)) %>% dplyr::rename("	How much does your current level of physical (in-)activity increase or decrease your risk of disease?" = disease) %>% gglikert(., `	How much does your current level of physical (in-)activity increase or decrease your risk of disease?`, facet_cols = vars(Cohort), add_labels = FALSE) + geom_vline(xintercept = 0)

bind_rows(select(US_1stWide, Cohort, weight), select(Other_1stWide, Cohort, weight)) %>% dplyr::rename("My current level of physical activity is helping me achieve or maintain a healthy body weight." = weight) %>% gglikert(., `My current level of physical activity is helping me achieve or maintain a healthy body weight.`, facet_cols = vars(Cohort), add_labels = FALSE) + geom_vline(xintercept = 0)

bind_rows(select(US_1stWide, Cohort, beneficial), select(Other_1stWide, Cohort, beneficial)) %>% dplyr::rename("How harmful/beneficial is your current level of physical activity for your health?" = beneficial) %>% gglikert(., `How harmful/beneficial is your current level of physical activity for your health?`, facet_cols = vars(Cohort), add_labels = FALSE) + geom_vline(xintercept = 0)

bind_rows(select(US_1stWide, Cohort, muscles), select(Other_1stWide, Cohort, muscles)) %>% dplyr::rename("How much is your current level of physical (in-)activity strengthening or weakening your muscles?" = muscles) %>% gglikert(., `How much is your current level of physical (in-)activity strengthening or weakening your muscles?`, facet_cols = vars(Cohort), add_labels = FALSE)  + geom_vline(xintercept = 0)

bind_rows(select(US_1stWide, Cohort, weight, unhealthy), select(Other_1stWide, Cohort, weight, unhealthy))%>% dplyr::rename("My current level of physical activity is unhealthy." = unhealthy)  %>% dplyr::rename("My current level of physical activity is helping me achieve or maintain a healthy body weight." = weight) %>% gglikert(., `My current level of physical activity is unhealthy.`:`My current level of physical activity is helping me achieve or maintain a healthy body weight.`, facet_cols = vars(Cohort), add_labels = FALSE) + geom_vline(xintercept = 0)
```

# ACTIVITY AND SLEEP SURVEY

## First response, comparison 1

```{r}
actsleep_US <- US_1stWide %>% dplyr::select(healthCode, work, atwork, phys_activity, moderate_act, vigorous_act, sleep_time, sleep_time1, sleep_diagnosis1, sleep_diagnosis2, Cohort) 
actsleep_UK <- Other_1stWide %>% dplyr::select(healthCode, work, atwork, phys_activity, moderate_act, vigorous_act, sleep_time, sleep_time1, sleep_diagnosis1, sleep_diagnosis2, Cohort) 
act_sleep <- bind_rows(actsleep_US, actsleep_UK) %>% as.data.frame()

kable(FreqWPerc(act_sleep, work, Cohort), caption = "Do you do regular work?") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(act_sleep, atwork, Cohort), caption = "Work Time Activity.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(act_sleep, phys_activity, Cohort), caption = "Leisure Time Activity.") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(act_sleep, moderate_act, Cohort), caption = "Overall, how many minutes of moderate activity do you get in a week?") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(act_sleep, vigorous_act, Cohort), caption = "Overall, how many minutes of vigorous activity do you get in a week?") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(act_sleep, sleep_time1, Cohort), caption = "How much sleep do you usually get at night on weekdays or workdays?") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(act_sleep, sleep_time, Cohort), caption = "How much sleep do think you need every night to be rested?  (in hours)") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(act_sleep, sleep_diagnosis1, Cohort), caption = "Have you ever been told by a doctor or other health professional that you have a sleep disorder?") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(act_sleep, sleep_diagnosis2, Cohort), caption = "Which of the following sleep disorders apply to you? (select all that apply).") %>% kable_styling(full_width = TRUE)

```

```{r}
act_sleep %>% filter(!is.na(moderate_act)) %>% ggplot(aes(x = Cohort, y = moderate_act, colour = Cohort)) + geom_boxplot() + geom_jitter() + theme_minimal() +  scale_color_manual(values = c("deeppink", "midnightblue")) + ylab("Weekly moderate activity (min)") + ggtitle("Self reported minutes of moderate activity")

act_sleep %>% filter(!is.na(vigorous_act)) %>% ggplot(aes(x = Cohort, y = vigorous_act, colour = Cohort)) + geom_boxplot() + geom_jitter() + theme_minimal() +  scale_color_manual(values = c("deeppink", "midnightblue")) + ylab("Weekly vigorous activity (min)") + ggtitle("Self reported minutes of vigorous activity")

act_sleep %>% filter(!is.na(sleep_time)) %>% ggplot(aes(x = Cohort, y = sleep_time, colour = Cohort)) + geom_boxplot() + geom_jitter() + theme_minimal() + ylab("Required sleep (hours)") + ggtitle("How much sleep do think you need every night to be rested?") + scale_color_manual(values = c("deeppink", "midnightblue")) + theme(legend.title = element_blank())

act_sleep %>% filter(!is.na(sleep_time1)) %>% ggplot(aes(x = Cohort, y = sleep_time1, colour = Cohort)) + geom_boxplot() + geom_jitter() + theme_minimal()  + ylab("Self reported weeknight sleep") + ggtitle("How much sleep do you usually get at night on weekdays or workdays?")+ scale_color_manual(values = c("deeppink", "midnightblue"))+ theme(legend.title = element_blank())
```

## Statistical tests

Fisher for work, wilcox for the rest

```{r}
fish_work<- fisher.test(act_sleep$work, act_sleep$Cohort) 

kw_atwork <- wilcox.test(atwork ~ Cohort, data = Numeric_vars)
kw_physact <- wilcox.test(phys_activity ~ Cohort, data = Numeric_vars)
kw_modact <- wilcox.test(moderate_act ~ Cohort, data = Numeric_vars)
kw_vigact<- wilcox.test(vigorous_act ~ Cohort, data = Numeric_vars)

kw_sleep <- wilcox.test(sleep_time ~ Cohort, data = Numeric_vars)
kw_sleep1 <- wilcox.test(sleep_time1 ~ Cohort, data = Numeric_vars)

actsleep_pvals <- rbind(c("work", "Do you do regular work?", fish_work$p.value),
                         c("atwork", "Physicality of work time activity", kw_atwork$p.value),
                         c("phys_activity", "Physicality of work time activity", kw_physact$p.value),
                         c("moderate_act", "Overall, how many minutes of moderate activity do you get in a week?", kw_modact$p.value[1]),
                         c("vigorous_act", "Overall, how many minutes of vigorous activity do you get in a week?", kw_vigact$p.value[1]),
                         c("sleep_time", "How much sleep do think you need every night to be rested? (in hours)", kw_sleep$p.value[1]),
                         c("sleep_time1", "How much sleep do you usually get at night on weekdays or workdays?", kw_sleep1$p.value[1]) )
colnames(actsleep_pvals) <- c("variable", "Prompt", "p_value")

actsleep_pvals <- as.data.frame(actsleep_pvals)

kable(actsleep_pvals) %>% kable_styling(full_width = TRUE)

```


# Risk Factor Survey

## First response, comparison 1

```{r}
RF_US <- US_1stWide %>% dplyr::select(healthCode, family_history, medications_to_treat, heart_disease, vascular, ethnicity, race,  education, Cohort) 
RF_UK <- Other_1stWide %>% dplyr::select(healthCode, family_history, medications_to_treat, heart_disease, vascular, ethnicity, race,  education, Cohort) 
RF <- bind_rows(RF_US, RF_UK) %>% as.data.frame()

kable(FreqWPerc(RF, family_history, Cohort), caption = "Do you have a family history of early heart disease?") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(RF, medications_to_treat, Cohort), caption = "Do you take medications to treat the following risk factors (indicate all that apply)") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(RF, heart_disease, Cohort), caption = "Have you been diagnosed with any of the below diseases?") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(RF, vascular, Cohort), caption = "Which vascular disease diagnosis have you received?") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(RF, ethnicity, Cohort), caption = "Are you Spanish/Hispanic/Lation? Choose the best answer. ") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(RF, race, Cohort), caption = "What is your race? Choose one or more races to indicate what you consider yourself to be. ") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(RF, education, Cohort), caption = "What is the highest grade in school you finished? Choose the best answer. NB 1st answer only, NOT highest achieved") %>% kable_styling(full_width = TRUE)
```


# Satisfaction Survey

## First response, comparison 1

```{r}
Satis_US <- US_1stWide %>% dplyr::select(healthCode, satisfiedwith_life, feel_worthwhile1, feel_worthwhile2, feel_worthwhile3, feel_worthwhile4, riskfactors1, riskfactors2, riskfactors3, riskfactors4, Cohort) 
Satis_UK <- Other_1stWide %>% dplyr::select(healthCode,  satisfiedwith_life, feel_worthwhile1, feel_worthwhile2, feel_worthwhile3, feel_worthwhile4, riskfactors1, riskfactors2, riskfactors3, riskfactors4,  Cohort) 
Satisfaction <- bind_rows(Satis_US, Satis_UK) %>% as.data.frame()

kable(FreqWPerc(Satisfaction, satisfiedwith_life, Cohort), caption = "Overall, how satisfied are you with life as a whole these days?") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(Satisfaction, feel_worthwhile1, Cohort), caption = "Overall, to what extent do you feel the things you do in your life are worthwhile?") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(Satisfaction, feel_worthwhile2, Cohort), caption = "How about happy?") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(Satisfaction, feel_worthwhile3, Cohort), caption = "How about worried?") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(Satisfaction, feel_worthwhile4, Cohort), caption = "How about depressed?") %>% kable_styling(full_width = TRUE)
```

```{r}
kw_sat <- wilcox.test(satisfiedwith_life ~ Cohort, data = Numeric_vars)
kw_fw1 <- wilcox.test(feel_worthwhile1 ~ Cohort, data = Numeric_vars)
kw_fw2 <- wilcox.test(feel_worthwhile2 ~ Cohort, data = Numeric_vars)
kw_fw3 <- wilcox.test(feel_worthwhile3 ~ Cohort, data = Numeric_vars)
kw_fw4 <- wilcox.test(feel_worthwhile4 ~ Cohort, data = Numeric_vars)

sat_pvals <- rbind(c("satisfiedwith_life", "Overall, how satisfied are you with life as a whole these days?", kw_sat$p.value[1]),
                   c("feel_worthwhile1", "Overall, to what extent do you feel the things you do in your life are worthwhile?", kw_fw1$p.value[1]),
                   c("feel_worthwhile2", "How about happy?", kw_fw2$p.value[1]),
                   c("feel_worthwhile3", "How about worried?", kw_fw3$p.value[1]),
                   c("feel_worthwhile4", "How about depressed?", kw_fw4$p.value[1]))

colnames(sat_pvals) <- c("variable", "Prompt", "p_value")

sat_pvals <- as.data.frame(sat_pvals)

kable(sat_pvals) %>% kable_styling(full_width = TRUE)
```


```{r}
kable(FreqWPerc(Satisfaction, riskfactors1, Cohort), caption = "Over the next 10 years how likely do you think it is that you personally will have a heart attack, stroke, or die due to cardiovascular disease? (choose one)") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(Satisfaction, riskfactors2, Cohort), caption = "Over the next 10 years, compared to others your age and sex, how would you rate your risk of having a heart attack, stroke, or dying due to cardiovascular disease? (choose one)") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(Satisfaction, riskfactors3, Cohort), caption = "Over your lifetime how likely do you think it is that you personally will have a heart attack, stroke, or die due to cardiovascular disease? (choose one)") %>% kable_styling(full_width = TRUE)

kable(FreqWPerc(Satisfaction, riskfactors4, Cohort), caption = "Over your lifetime, compared to others your age and sex, how would you rate your risk of having a heart attack, stroke, or dying due to cardiovascular disease? (choose one)") %>% kable_styling(full_width = TRUE)
```

```{r}
# List of variables for which Fisher's exact test will be performed
variable_list_RF <- QuestionKey %>% filter(Identifier %in% c("riskfactors1", "riskfactors2", "riskfactors3", "riskfactors4")) %>% dplyr::select(-Sheet)

# Perform Kruskal wallis test for each variable
KW_pvals_RF <- lapply(variable_list_RF$Identifier, function(var) {
  formula <- as.formula(paste(var, "~ Cohort"))
  KW_result <- wilcox.test(formula, data = Numeric_vars) 
  p_value <- KW_result$p.value
  return(p_value)
})

# Create a table of p-values
KW_pvals_RF <- data.frame(variable = variable_list_RF$Identifier, Prompt = variable_list_RF$Prompt, p_value = unlist(KW_pvals_RF)) %>% dplyr::arrange(p_value) %>% mutate(p_adj = p.adjust(p_value, method = "BH")) 

kable(KW_pvals_RF, caption = "Kruskal test p values for satisfaction survey risk factors") %>% kable_styling(full_width = TRUE)

```


# Par-Q Quiz

## First response, comparison 1

```{r}
Parq_US <- US_1stWide %>% dplyr::select(healthCode, heartCondition, chestPain, chestPainInLastMonth, dizziness, jointProblem, physicallyCapable, prescriptionDrugs, Cohort) 
Parq_UK <- Other_1stWide %>% dplyr::select(healthCode, heartCondition, chestPain, chestPainInLastMonth, dizziness, jointProblem, physicallyCapable, prescriptionDrugs, Cohort) 
Parq <- bind_rows(Parq_US, Parq_UK) %>% as.data.frame()

hc <- FreqWPerc(Parq, heartCondition, Cohort) %>% as.data.frame()
cp <-  FreqWPerc(Parq, chestPain, Cohort) %>% as.data.frame()
cpim <- FreqWPerc(Parq, chestPainInLastMonth, Cohort) %>% as.data.frame()
d <- FreqWPerc(Parq, dizziness, Cohort) %>% as.data.frame()
jp <- FreqWPerc(Parq, jointProblem, Cohort) %>% as.data.frame()
pc <- FreqWPerc(Parq, physicallyCapable, Cohort) %>% as.data.frame()
pd <- FreqWPerc(Parq, prescriptionDrugs, Cohort) %>% as.data.frame()

kable(hc, caption = "has your doctor ever said that you have a heart condition and that you should only do physical activity recommended by a doctor? ") %>% kable_styling(full_width = TRUE)

kable(cp, caption = "Do you feel pain in your chest when you do physical activity?") %>% kable_styling(full_width = TRUE)

kable(cpim, caption = "In the past month, have you had chest pain when you were not doing physical activity? ") %>% kable_styling(full_width = TRUE)

kable(d, caption = "Do you lose your balanced because of dizziness or do you ever lose consciousness? ") %>% kable_styling(full_width = TRUE)

kable(jp, caption = "Do you have a bone or joint problem that could be made worse by a change in your physical activity? ") %>% kable_styling(full_width = TRUE)

kable(pc, caption = "Do you know of any reason why you should not do physical activity? ") %>% kable_styling(full_width = TRUE)

kable(pd, caption = "Is your doctor currently prescribing drugs (for example water pills) for your blood pressure or heart condition? ") %>% kable_styling(full_width = TRUE)

```

```{r}
hc1 <- hc %>% pivot_longer(cols = !Cohort) %>% mutate(q = "Has your doctor ever said that you have a heart condition \n and that you should only do physical activity recommended by a doctor?")
cp1 <- cp %>% pivot_longer(cols = !Cohort) %>% mutate(q = "Do you feel pain in your chest when you do physical activity?")
cpim1 <- cpim %>% pivot_longer(cols = !Cohort) %>% mutate(q = "In the past month, have you had chest pain when you were not doing physical activity?")
d1 <- d %>% pivot_longer(cols = !Cohort) %>% mutate(q = "Do you lose your balanced because of dizziness or do you ever lose consciousness?")
jp1 <- jp %>% pivot_longer(cols = !Cohort) %>% mutate(q = "Do you have a bone or joint problem that could be made worse by a change in your physical activity?")
pc1 <- pc %>% pivot_longer(cols = !Cohort) %>% mutate(q = "Do you know of any reason why you should not do physical activity?")
pd1 <- pd %>% pivot_longer(cols = !Cohort) %>% mutate(q = "Is your doctor currently prescribing drugs (for example water pills) for your blood pressure or heart condition?")

a <- rbind(hc1, cp1, cpim1, d1, jp1, pc1, pd1) 
a[c("value", "n")] <- str_split_fixed(a$value, '%', 2)
a <- a %>% mutate(value = as.numeric(value)) 

ggplot(data =a, aes(x = Cohort, y = value, group = name, fill = name)) + geom_col() + facet_wrap(~q, ncol = 1) + scale_fill_manual(values = c("deeppink", "midnightblue")) + labs(x = "", y = "% answer")
```


# P-values

```{r}
all_pvals <- do.call(rbind, list(dplyr::select(KW_pvals_IllnessMindset, variable, Prompt, p_value),
dplyr::select(KW_pvals_Expro, variable, Prompt, p_value),
dplyr::select(KW_pvals_Act, variable, Prompt, p_value),
dplyr::select(KW_pvals_RF, variable, Prompt, p_value),
dplyr::select(Fisher_pvals_parq_tab, variable, Prompt, p_value),
dplyr::select(sat_pvals, variable, Prompt, p_value),
dplyr::select(diet_pvals, variable, Prompt, p_value),
dplyr::select(actsleep_pvals, variable, Prompt, p_value), c("current_nicotine", "Do you currently smoke / use a vape/ use smokeless products?", fish_currentsmoke$p.value)  ))

all_pvals <- all_pvals %>% mutate(p_adj = p.adjust(p_value, method = "BH") ) %>% arrange(p_adj, p_value)

kable(all_pvals) %>% kable_styling(full_width = TRUE)

```

```{r}
library(psych)
illnessmind


```








